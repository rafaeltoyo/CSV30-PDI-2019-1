#!/usr/bin/env python
# -*- coding: utf-8 -*-

import numpy as np
import cv2

from utils.mytimer import Timer
from utils.pathbuilder import PathBuilder

from projetos.t2.blur import box_blur_1, box_blur_2


def projeto2():

    # ================================================================================================================ #
    #   Constantes
    # ---------------------------------------------------------------------------------------------------------------- #
    INPUT_IMG = 2
    THRESHOLD_VALUE = 0.75
    COMP_MIN_WIDTH = 4
    COMP_MIN_HEIGHT = 4
    COMP_MIN_PIXEL = 9

    # ================================================================================================================ #
    #   Timers
    # ---------------------------------------------------------------------------------------------------------------- #
    timer_general = Timer(txt="Total")
    timer_blur = Timer(txt="Blur")

    # ================================================================================================================ #
    #   Imagens
    # ---------------------------------------------------------------------------------------------------------------- #
    images_name = ['arroz.bmp', 'documento-3mp.bmp', 'zumbi.bmp']
    prj_path = PathBuilder()

    # ================================================================================================================ #
    #   Abrir a imagem
    # ---------------------------------------------------------------------------------------------------------------- #
    timer_general.start()
    img = cv2.imread(prj_path.inputdir(images_name[INPUT_IMG]))

    # ================================================================================================================ #
    #   Normalizar a imagem
    # ---------------------------------------------------------------------------------------------------------------- #
    nimg = cv2.normalize(img, None, alpha=0, beta=1, norm_type=cv2.NORM_MINMAX, dtype=cv2.CV_32F)

    # ================================================================================================================ #
    #   Função de binarização
    # ---------------------------------------------------------------------------------------------------------------- #
    timer_blur.start()
    nimg = box_blur_1(nimg, 10, 10)
    timer_blur.stop()

    # ================================================================================================================ #
    #   Gerar imagem borrada
    # ---------------------------------------------------------------------------------------------------------------- #
    cv2.imwrite(prj_path.outputdir('borrada.bmp'),
                cv2.normalize(nimg, None, alpha=0, beta=255, norm_type=cv2.NORM_MINMAX))

    # Inversão na imagem do documento
    if INPUT_IMG == 1:
        nimg = np.where(nimg == 1, 0, 1)

    # ================================================================================================================ #
    #   Gerar imagem das componentes encontradas
    # ---------------------------------------------------------------------------------------------------------------- #
    #cv2.imwrite(prj_path.outputdir('output.bmp'), img)
    timer_general.stop()

    # ================================================================================================================ #
    #   Apresentar o número de componentes encontradas
    # ---------------------------------------------------------------------------------------------------------------- #
    print("Tempos de execução")
    timer_general.result()
    timer_blur.result()

    # ================================================================================================================ #
